{% extends 'base.html' %}

{% block header %}
	{% if request.user.is_authenticated %}
        <div class='page-info'>
			<h3> Cadastro de Aluno </h3>
		</div>
	{% else %}
		<div class='page-info-anonymous'>
			<h3> Cadastro de Aluno </h3>
		</div>
	{% endif %}
{% endblock %}

{% block content %}
{% if error is not None %}
	<div class='error-overlay'>
		<div class='error-popup' onclick="this.parentElement.style.display='none'">
			<h2>Aviso</h2>
			<a class='error-close'>&times;</a>
			<div class='error-content'>
				<p>{{ error }}</p>
			</div>
		</div>
	</div>
{% endif %}

<div id='container' class='message-overlay' style='display: none;'>
	<div class='message-popup' onclick="this.parentElement.style.display='none'">
		<h2 id='title'></h2>
		<a class='message-close'>&times;</a>
		<div class='message-content'>
			<p id='address'></p>
			<p id='district'></p>
			<p id='city'></p>
			<p id='uf'></p>
			<p id='error'></p>		
		</div>
	</div>
</div>

<div id='container_document' class='message-overlay' style='display: none;'>
	<div class='message-popup' onclick="this.parentElement.style.display='none'">
		<h2 id='title_document'></h2>
		<a class='message-close'>&times;</a>
		<div class='message-content'>
			<p id='message_document'></p>		
		</div>
	</div>
</div>

<div class='form'>
	<div class='form-button-return'>
		<i class='fas fa-arrow-circle-left' onclick="window.location.href=`{% url 'student-list' %}`"></i>
	</div>
	<form autocomplete='off' method='post' action='.' enctype='multipart/form-data'>
		{% csrf_token  %}
		<div class='form-file-block'>
			<div class='preview'>
				{% if student.foto %}
					<img src='{{ student.foto.url }}' alt='Prévia' id='preview_image' style='display: block;'>
					<span id='preview_icon' style='display: none;'>
						<i class='far fa-user'></i>
					</span>
				{% else %}
					<img src='' alt='Prévia' id='preview_image'>
					<span id='preview_icon'>
						<i class='far fa-user'></i>
					</span>
				{% endif %}
			</div>

			{% if student.foto %}
				<input type='file' accept='image/*' name='foto' id='foto' />
			{% else %}
				<input type='file' accept='image/*' name='foto' id='foto' required/>
			{% endif %}
			<label title='Preencha esse campo' for='foto'>Foto do Estudante</label>
		</div>
		
		<div class='form-group'>
			<div class='form-block'>
				<label for='nome'>Nome *</label>
				<input 
					type='text' 
					name='nome' 
					required 
					placeholder='Preencha com o nome'
					pattern='[a-zA-Zà-úÀ-Ú][a-zA-Zà-úÀ-Ú\s]*'
					maxlength='45' 
					title='Preencha campo com apenas caracteres alfabéticos'
					value='{{ student.nome }}' 
				>
			</div>
			<div class='form-block'>
				<label for='data_nasc'>Data de nascimento *</label>
				<input
					type='date'
					name='data_nasc'
					required
					title='Preencha campo com uma data válida' 
					value='{{ student.data_nasc|date:"Y-m-d" }}'
				>
			</div>
		</div>

		<div class='form-group'>
			<div class='form-block'>
				<label for='email'>E-mail *</label>
				{% if edit is True %}
					<input 
						type='email' 
						name='email' 
						required 
						placeholder='Preencha com o e-mail'
						title='Preencha campo com o formato padrão de e-mail'
						value='{{ student.email }}' 
						readonly 
					>
				{% else %}
					<input 
						type='email' 
						name='email' 
						required 
						placeholder='Preencha com o e-mail'
						title='Preencha campo com o formato padrão de e-mail'
						value='{{ student.email }}' 
					>
				{% endif %}
			</div>
			<div class='form-block'>
				<label for='senha'>Senha *</label>
				{% if edit is True %}
					<input 
						type='password' 
						name='senha' 
						maxlength='20' 
						minlength='6'
						pattern='.{6,}'  
						title='Preencha campo com no mínimo seis caracteres' 
						placeholder='Preencha com uma nova senha'
						value='{{ student.senha }}' 
					>
				{% else %}
					<input 
						type='password' 
						name='senha' 
						maxlength='20' 
						minlength='6'
						pattern='.{6,}' 
						required 
						title='Preencha campo com no mínimo seis caracteres' 
						placeholder='Preencha com a senha'
						value='{{ student.senha }}' 
					>
				{% endif %}
			</div>
		</div>

		<div class='form-group'>
			<div class='form-block'>
				<label for='cpf'>CPF *</label>
				{% if edit is True %}
					<input 
						type='text' 
						name='cpf' 
						required 
						placeholder='Preencha com o CPF'
						maxlength='14'
						pattern='[0-9]{3}[\.][0-9]{3}[\.][0-9]{3}[-][0-9]{2}' 
						title='Preencha campo com o formato padrão de CPF' 
						onkeypress="mascaraCPF(this)"
						onblur="validarCPF(this)"
						value='{{ student.cpf }}'
						readonly 
					>
				{% else %}
					<input 
						type='text' 
						name='cpf' 
						required 
						placeholder='Preencha com o CPF'
						maxlength='14'
						pattern='[0-9]{3}[\.][0-9]{3}[\.][0-9]{3}[-][0-9]{2}' 
						title='Preencha campo com o formato padrão de CPF' 
						onkeypress="mascaraCPF(this)"
						onblur="validarCPF(this)"
						value='{{ student.cpf }}' 
					>
				{% endif %}
			</div>
			<div class='form-block'>
				<label for='celular'>Celular *</label>
				<input 
					type='text' 
					name='celular'
					required
					placeholder='Preencha com o número de telefone celular'
					pattern='[\(][0-9]{2}[\)][\s]{1}[0-9]{5}[-][0-9]{4}' 
					title='Preencha campo com o formato padrão de celular' 
					maxlength='15'
					onkeypress="mascaraCelular(this)"
					value='{{ student.celular }}' 
				>
			</div>
		</div>

		<div class='form-group'>
			<div class='form-block'>
				<label for='cep'>CEP *</label>
				<input 
					type='text' 
					name='cep' 
					required 
					placeholder='Preencha com o CEP'
					maxlength='10'
					title='Preencha campo com o formato padrão de CEP' 
					pattern='[0-9]{2}[\.][0-9]{3}[-][0-9]{3}' 
					onkeypress="mascaraCEP(this)" 
					onblur="validarCEP(this)" 
					value='{{ student.cep }}' 
				>
			</div>
			<div class='form-block'>
				<label for='numero'>Número *</label>
				<input 
					type='text' 
					name='numero'
					pattern='[0-9]*' 
					required 
					placeholder='Preencha com o número da residência'
					title='Preencha campo com apenas caracteres númericos' 
					maxlength='5'
					value='{{ student.numero }}' 
				>
			</div>
		</div>

		<div class='form-group'>
			<div class='form-block'>
				<label for='cid'>CID *</label>
				<select multiple name='cid' title='Selecione múltiplos itens'>
					{% for item in cid_list %}
						<option value='{{ item.pk }}'>{{item.codigo}}: {{ item.descricao }}</option>
					{% endfor %}
				</select>
			</div>
			<div class='form-block'>
				<label for='outra_info'>Outras informações</label>
				<textarea name='outra_info' placeholder='Preencha com outras informações relevantes' maxlength='100'>{{ student.outra_info }}</textarea>
			</div>
		</div>

		<div class='form-group-checkbox'>
			<div class='form-block-checkbox'>
				<label for='comando_voz' class='checkbox-label'>Comando por voz
					{% if student.comando_voz is True %}
						<input type='checkbox' id='comando_voz' name='comando_voz' value='sim' checked onclick='selecionarComando()'>
						<input id='comando_hidden' type='hidden' value='nao' name='comando_voz' disabled>
					{% else %}
						<input type='checkbox' id='comando_voz' name='comando_voz' value='sim' onclick='selecionarComando()'>
						<input id='comando_hidden' type='hidden' value='nao' name='comando_voz'>
					{% endif %}
  					<span class='checkmark'></span>
				</label>
			</div>
			<div class='form-block-checkbox'>
				<label for='ajuda_voz' class='checkbox-label'>Ajuda por voz
					{% if student.ajuda_voz is True %}
						<input type='checkbox' id='ajuda_voz' name='ajuda_voz' value='sim' checked onclick='selecionarAjuda()'>
						<input id='ajuda_hidden' type='hidden' value='nao' name='ajuda_voz' disabled>
					{% else %}
						<input type='checkbox' id='ajuda_voz' name='ajuda_voz' value='sim' onclick='selecionarAjuda()'>
						<input id='ajuda_hidden' type='hidden' value='nao' name='ajuda_voz'>
					{% endif %}
  					<span class='checkmark'></span>
				</label>

			</div>
			<div class='form-block-checkbox'>
				<label for='nvda' class='checkbox-label'>NVDA
					{% if student.nvda is True %}
						<input type='checkbox' id='nvda' name='nvda' value='sim' checked onclick='selecionarNVDA()'>
						<input id='nvda_hidden' type='hidden' value='nao' name='nvda' disabled>
					{% else %}
						<input type='checkbox' id='nvda' name='nvda' value='sim' onclick='selecionarNVDA()'>
						<input id='nvda_hidden' type='hidden' value='nao' name='nvda'>
					{% endif %}
  					<span class='checkmark'></span>
				</label>
			</div>
		</div>

		<button type='submit'>Salvar</button>
	</form>
</div>
<script>
	const input = document.getElementById('foto');
	const imagem = document.getElementById('preview_image')
	const icone = document.getElementById('preview_icon');

	input.addEventListener('change', function() {
		const arquivo = this.files[0];

		if (arquivo) {
			const leitor = new FileReader();

			icone.style.display = 'none';
			imagem.style.display = 'flex';

			leitor.addEventListener('load', function() {
				imagem.setAttribute('src', this.result);	
			});

			leitor.readAsDataURL(arquivo);
		}
	});

	function selecionarComando() {
		if(document.getElementById('comando_voz').checked) {
    		document.getElementById('comando_hidden').disabled = true;
		} else {
			document.getElementById('comando_hidden').disabled = false;
		}
	}


	function selecionarAjuda() {
		if(document.getElementById('ajuda_voz').checked) {
    		document.getElementById('ajuda_hidden').disabled = true;
		} else {
			document.getElementById('ajuda_hidden').disabled = false;
		}
	}

	function selecionarNVDA() {
		if(document.getElementById('nvda').checked) {
    		document.getElementById('nvda_hidden').disabled = true;
		} else {
			document.getElementById('nvda_hidden').disabled = false;
		}
	}
</script>
{% endblock %}